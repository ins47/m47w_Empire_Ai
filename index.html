<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Google Sheets SVG Map</title>

<style>
  body {
    margin: 0;
    background: #000;
  }

  svg {
    width: 100%;
    height: auto;
    display: block;
  }

  .grid-cell {
    fill: transparent;
    cursor: pointer;
    transition: fill 0.2s ease;
  }

  /* Hover ONLY for non-colored cells */
  .grid-cell:not([data-colored="true"]):hover {
    fill: rgba(0, 150, 255, 0.25);
  }
</style>
</head>

<body>

<svg
  width="1536"
  height="695"
  viewBox="0 0 1536 695"
  xmlns="http://www.w3.org/2000/svg"
>

  <!-- BASE MAP -->
  <image
    href="https://raw.githubusercontent.com/ins47/m47w_Empire_Ai/db2c6e921df26a3fb3986c7a076f039bdeb137d3/maps.svg"
    x="0"
    y="0"
    width="1536"
    height="695"
    preserveAspectRatio="none"
  />

  <!-- GRID -->
  <g id="grid"></g>

</svg>

<script>
  /* ================= CONFIG ================= */

  const COLS = 53;
  const ROWS = 24;
  const SVG_WIDTH = 1536;
  const SVG_HEIGHT = 695;

  const REFRESH_INTERVAL = 10000; // ðŸ”„ 10 seconds

  const SHEET_URL =
    "https://docs.google.com/spreadsheets/d/1pohzT2C9giZBJ_eH932_y_tXMCl8GjnpE5bJPgPL9ew/export?format=csv&gid=0";

  /* ========================================== */

  const CELL_W = SVG_WIDTH / COLS;
  const CELL_H = SVG_HEIGHT / ROWS;

  const grid = document.getElementById("grid");
  const cells = {};

  /* ===== BUILD GRID ONCE ===== */

  let zone = 1;

  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {

      const rect = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "rect"
      );

      rect.setAttribute("x", c * CELL_W);
      rect.setAttribute("y", r * CELL_H);
      rect.setAttribute("width", CELL_W);
      rect.setAttribute("height", CELL_H);
      rect.setAttribute("class", "grid-cell");
      rect.dataset.zone = zone;

      const title = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "title"
      );
      title.textContent = "Zone " + zone;
      rect.appendChild(title);

      rect.onclick = () => {
        window.open(
          "https://example.com/zone-" + zone,
          "_blank"
        );
      };

      grid.appendChild(rect);
      cells[zone] = rect;
      zone++;
    }
  }

  /* ===== LOAD COLORS FROM GOOGLE SHEETS ===== */

  function loadColors() {
    fetch(SHEET_URL + "&t=" + Date.now()) // cache bust
      .then(res => res.text())
      .then(csv => {
        const rows = csv.split("\n").slice(1);

        rows.forEach(row => {
          const [z, color] = row.split(",");
          if (!cells[z]) return;

          if (color && color.trim() !== "") {
            cells[z].style.fill = color.trim();
            cells[z].setAttribute("data-colored", "true");
          } else {
            cells[z].style.fill = "transparent";
            cells[z].removeAttribute("data-colored");
          }
        });
      })
      .catch(err => {
        console.error("Sheet load error:", err);
      });
  }

  /* ===== INITIAL LOAD + AUTO REFRESH ===== */

  loadColors();
  setInterval(loadColors, REFRESH_INTERVAL);

</script>

</body>

</html>
